í˜„ì¬ Listening ê¸´ ì»¨í…ì¸ ì˜ í•™ìŠµ í”Œë¡œìš°ë¥¼ ê°œì„ í•´ì¤˜.

=== ë¬¸ì œì  ===
í˜„ì¬ëŠ” ë¬¸ì¥ì´ ê°œë³„ì ìœ¼ë¡œ ë‚˜ë‰˜ì–´ ìˆì–´ì„œ
ì „ì²´ íë¦„ì„ íŒŒì•…í•˜ê¸° ì–´ë ¤ì›€.

ì‹¤ì œ ë¦¬ìŠ¤ë‹ í•™ìŠµì€:
1ë‹¨ê³„: ì „ì²´ë¥¼ ë¨¼ì € ë“£ê¸° (í° ê·¸ë¦¼)
2ë‹¨ê³„: ë¬¸ì¥ë³„ë¡œ ì§‘ì¤‘ í•™ìŠµ (ì„¸ë¶€)

ì´ë ‡ê²Œ 2ë‹¨ê³„ë¡œ ì§„í–‰ë˜ì–´ì•¼ íš¨ê³¼ì ì„.

=== ê°œì„  ë°©í–¥ ===

ListeningCardLong ì»´í¬ë„ŒíŠ¸ë¥¼ 2ë‹¨ê³„ í•™ìŠµ í”Œë¡œìš°ë¡œ ê°œì„ :

**1ë‹¨ê³„: ì „ì²´ ë“£ê¸° ëª¨ë“œ**
- ì „ì²´ í…ìŠ¤íŠ¸ë¥¼ í•œ ë²ˆì— ë³´ì—¬ì¤Œ
- ì „ì²´ ì˜¤ë””ì˜¤ë¥¼ ì­‰ ì¬ìƒ
- ì—¬ëŸ¬ ë²ˆ ë°˜ë³µ ì¬ìƒ ê°€ëŠ¥
- ì „ì²´ ë²ˆì—­ í† ê¸€
- "ë‹¤ìŒ ë‹¨ê³„" ë²„íŠ¼ â†’ 2ë‹¨ê³„ë¡œ ì´ë™

**2ë‹¨ê³„: ë¬¸ì¥ë³„ í•™ìŠµ ëª¨ë“œ**
- ë¬¸ì¥ë³„ë¡œ ë‚˜ëˆ„ì–´ì„œ í‘œì‹œ (í˜„ì¬ ë°©ì‹)
- ê° ë¬¸ì¥ ê°œë³„ ì¬ìƒ
- ë¬¸ì¥ë³„ ë²ˆì—­
- ë°›ì•„ì“°ê¸° â†’ ì ìˆ˜

=== ìƒì„¸ êµ¬í˜„ ì‚¬í•­ ===

components/listening/ListeningCardLong.tsx ì „ë©´ ìˆ˜ì •:
```tsx
'use client'

import { useState } from 'react'
import { X, Volume2, ArrowRight, ArrowLeft } from 'lucide-react'
import AudioPlayerAdvanced from './AudioPlayerAdvanced'
import DictationInput from './DictationInput'
import ResultModal from './ResultModal'
import ClickableText from './ClickableText'
import { compareTexts, getHighlightedWords } from '@/lib/listening/scoreUtils'
import type { ComparisonResult } from '@/lib/listening/scoreUtils'

interface Paragraph {
  text: string
  translation: string
}

interface LongLesson {
  id: string
  text: string
  translation: string
  difficulty: number
  category: string
  content_type: string
  paragraphs: Paragraph[]
  word_count: number
  estimated_duration: number
}

interface ListeningCardLongProps {
  lesson: LongLesson
  onClose: () => void
  onComplete: () => void
}

export default function ListeningCardLong({ lesson, onClose, onComplete }: ListeningCardLongProps) {
  // í•™ìŠµ ë‹¨ê³„: 'overview' (ì „ì²´ ë“£ê¸°) â†’ 'detail' (ë¬¸ì¥ë³„ í•™ìŠµ)
  const [learningStage, setLearningStage] = useState<'overview' | 'detail'>('overview')
  
  // ì „ì²´ ë“£ê¸° ëª¨ë“œ ìƒíƒœ
  const [showFullTranslation, setShowFullTranslation] = useState(false)
  const [fullListenCount, setFullListenCount] = useState(0)
  
  // ë¬¸ì¥ë³„ í•™ìŠµ ëª¨ë“œ ìƒíƒœ
  const [currentSentenceIndex, setCurrentSentenceIndex] = useState(0)
  const [showSentenceTranslation, setShowSentenceTranslation] = useState(false)
  const [submitted, setSubmitted] = useState(false)
  const [userAnswer, setUserAnswer] = useState('')
  const [result, setResult] = useState<ComparisonResult | null>(null)
  const [showResult, setShowResult] = useState(false)
  
  const currentParagraph = lesson.paragraphs[currentSentenceIndex]
  const isLastSentence = currentSentenceIndex === lesson.paragraphs.length - 1
  
  // ì „ì²´ ë“£ê¸° ì™„ë£Œ í•¸ë“¤ëŸ¬
  const handleFullAudioComplete = () => {
    setFullListenCount(prev => prev + 1)
  }
  
  // ë¬¸ì¥ë³„ í•™ìŠµ ë‹¨ê³„ë¡œ ì´ë™
  const handleStartDetailLearning = () => {
    setLearningStage('detail')
    setCurrentSentenceIndex(0)
  }
  
  // ì „ì²´ ë“£ê¸°ë¡œ ëŒì•„ê°€ê¸°
  const handleBackToOverview = () => {
    setLearningStage('overview')
    setCurrentSentenceIndex(0)
    setSubmitted(false)
    setUserAnswer('')
    setResult(null)
  }
  
  // ë‹¤ìŒ ë¬¸ì¥ìœ¼ë¡œ
  const handleNextSentence = () => {
    if (currentSentenceIndex < lesson.paragraphs.length - 1) {
      setCurrentSentenceIndex(prev => prev + 1)
      setSubmitted(false)
      setUserAnswer('')
      setResult(null)
      setShowResult(false)
      setShowSentenceTranslation(false)
    }
  }
  
  // ì´ì „ ë¬¸ì¥ìœ¼ë¡œ
  const handlePrevSentence = () => {
    if (currentSentenceIndex > 0) {
      setCurrentSentenceIndex(prev => prev - 1)
      setSubmitted(false)
      setUserAnswer('')
      setResult(null)
      setShowResult(false)
      setShowSentenceTranslation(false)
    }
  }
  
  // ë°›ì•„ì“°ê¸° ì œì¶œ
  const handleSubmit = async (answer: string) => {
    setUserAnswer(answer)
    setSubmitted(true)
    
    const comparisonResult = compareTexts(currentParagraph.text, answer)
    setResult(comparisonResult)
    
    try {
      const response = await fetch('/api/listening/progress', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          lessonId: lesson.id,
          userAnswer: answer,
          score: comparisonResult.score,
          accuracy: comparisonResult.accuracy,
          completed: comparisonResult.score >= 70
        })
      })
      
      if (!response.ok) throw new Error('Failed to save progress')
      
      const xpAmount = Math.floor(comparisonResult.score / 5)
      await fetch('/api/gamification/xp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          amount: xpAmount,
          source: 'listening'
        })
      })
      
      setShowResult(true)
    } catch (error) {
      console.error('Failed to save progress:', error)
    }
  }
  
  const handleRetry = () => {
    setSubmitted(false)
    setUserAnswer('')
    setResult(null)
    setShowResult(false)
  }
  
  const handleResultNext = () => {
    setShowResult(false)
    if (isLastSentence) {
      onComplete()
    } else {
      handleNextSentence()
    }
  }
  
  return (
    <>
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50">
        <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
          {/* í—¤ë” */}
          <div className="sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between z-10">
            <div>
              <h2 className="text-xl font-bold text-gray-900">
                {learningStage === 'overview' ? '1ë‹¨ê³„: ì „ì²´ ë“£ê¸°' : '2ë‹¨ê³„: ë¬¸ì¥ë³„ í•™ìŠµ'}
              </h2>
              <div className="flex items-center gap-3 mt-1">
                <span className="text-sm text-gray-600">
                  Level {lesson.difficulty}
                </span>
                <span className="text-sm text-gray-400">â€¢</span>
                <span className="text-sm text-gray-600">
                  {lesson.category}
                </span>
                {learningStage === 'detail' && (
                  <>
                    <span className="text-sm text-gray-400">â€¢</span>
                    <span className="text-sm text-gray-600">
                      {currentSentenceIndex + 1} / {lesson.paragraphs.length}
                    </span>
                  </>
                )}
              </div>
            </div>
            
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <X className="w-6 h-6" />
            </button>
          </div>
          
          {/* ì»¨í…ì¸  */}
          <div className="p-6">
            {learningStage === 'overview' ? (
              /* ===== 1ë‹¨ê³„: ì „ì²´ ë“£ê¸° ëª¨ë“œ ===== */
              <div className="space-y-6">
                {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
                <div className="bg-blue-50 border border-blue-200 rounded-xl p-4">
                  <h3 className="font-semibold text-blue-900 mb-2">
                    ğŸ’¡ 1ë‹¨ê³„: ì „ì²´ ë‚´ìš© íŒŒì•…í•˜ê¸°
                  </h3>
                  <p className="text-sm text-blue-800">
                    ë¨¼ì € ì „ì²´ ë‚´ìš©ì„ ì—¬ëŸ¬ ë²ˆ ë“¤ìœ¼ë©° í° íë¦„ì„ íŒŒì•…í•˜ì„¸ìš”.
                    ì¤€ë¹„ê°€ ë˜ë©´ "ë¬¸ì¥ë³„ í•™ìŠµ ì‹œì‘" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                  </p>
                </div>
                
                {/* ì „ì²´ ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ */}
                <AudioPlayerAdvanced
                  text={lesson.text}
                  onPlayComplete={handleFullAudioComplete}
                />
                
                {/* ì¬ìƒ íšŸìˆ˜ */}
                {fullListenCount > 0 && (
                  <div className="text-center">
                    <span className="inline-block px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                      âœ“ {fullListenCount}íšŒ ë“¤ì—ˆì–´ìš”
                    </span>
                  </div>
                )}
                
                {/* ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ */}
                <div className="bg-gray-50 rounded-xl border border-gray-200 p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-gray-900">
                      ì „ì²´ ìŠ¤í¬ë¦½íŠ¸
                      <span className="text-sm text-gray-500 font-normal ml-2">
                        (ë‹¨ì–´ë¥¼ í´ë¦­í•˜ë©´ ëœ»ì„ ë³¼ ìˆ˜ ìˆì–´ìš”)
                      </span>
                    </h3>
                    <button
                      onClick={() => setShowFullTranslation(!showFullTranslation)}
                      className={`px-4 py-2 text-sm rounded-lg transition-colors ${
                        showFullTranslation
                          ? 'bg-green-600 text-white'
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      {showFullTranslation ? 'ë²ˆì—­ ìˆ¨ê¸°ê¸°' : 'ë²ˆì—­ ë³´ê¸°'}
                    </button>
                  </div>
                  
                  <div className="space-y-4">
                    {lesson.paragraphs.map((para, index) => (
                      <div
                        key={index}
                        className="p-4 bg-white border border-gray-200 rounded-lg"
                      >
                        <div className="text-gray-900 mb-2 leading-relaxed">
                          <ClickableText text={para.text} />
                        </div>
                        {showFullTranslation && (
                          <p className="text-sm text-gray-600 pt-2 border-t">
                            {para.translation}
                          </p>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
                
                {/* ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ */}
                <div className="flex justify-center pt-4">
                  <button
                    onClick={handleStartDetailLearning}
                    className="px-8 py-4 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-semibold text-lg flex items-center gap-3 shadow-lg hover:shadow-xl transition-all"
                  >
                    ë¬¸ì¥ë³„ í•™ìŠµ ì‹œì‘í•˜ê¸°
                    <ArrowRight className="w-6 h-6" />
                  </button>
                </div>
              </div>
            ) : (
              /* ===== 2ë‹¨ê³„: ë¬¸ì¥ë³„ í•™ìŠµ ëª¨ë“œ ===== */
              <div className="space-y-6">
                {/* ì§„í–‰ ìƒí™© */}
                <div className="bg-purple-50 border border-purple-200 rounded-xl p-4">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium text-purple-900">
                      ë¬¸ì¥ {currentSentenceIndex + 1} / {lesson.paragraphs.length}
                    </span>
                    <button
                      onClick={handleBackToOverview}
                      className="text-sm text-purple-700 hover:text-purple-900 flex items-center gap-1"
                    >
                      <ArrowLeft className="w-4 h-4" />
                      ì „ì²´ ë“£ê¸°ë¡œ ëŒì•„ê°€ê¸°
                    </button>
                  </div>
                  <div className="w-full bg-purple-200 rounded-full h-2">
                    <div
                      className="bg-purple-600 h-2 rounded-full transition-all"
                      style={{
                        width: `${((currentSentenceIndex + 1) / lesson.paragraphs.length) * 100}%`
                      }}
                    />
                  </div>
                </div>
                
                {/* í˜„ì¬ ë¬¸ì¥ */}
                <div className="bg-yellow-50 border-2 border-yellow-300 rounded-xl p-6">
                  <h3 className="font-semibold text-gray-900 mb-4">
                    í˜„ì¬ ë¬¸ì¥
                  </h3>
                  <div className="text-lg text-gray-900 mb-3 leading-relaxed">
                    <ClickableText text={currentParagraph.text} />
                  </div>
                  <button
                    onClick={() => setShowSentenceTranslation(!showSentenceTranslation)}
                    className="text-sm text-blue-600 hover:text-blue-700"
                  >
                    {showSentenceTranslation ? 'ë²ˆì—­ ìˆ¨ê¸°ê¸°' : 'ë²ˆì—­ ë³´ê¸°'}
                  </button>
                  {showSentenceTranslation && (
                    <p className="text-sm text-gray-600 mt-2 pt-2 border-t">
                      {currentParagraph.translation}
                    </p>
                  )}
                </div>
                
                {/* ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ */}
                <AudioPlayerAdvanced
                  text={currentParagraph.text}
                />
                
                {/* ë°›ì•„ì“°ê¸° */}
                {!submitted && (
                  <DictationInput onSubmit={handleSubmit} />
                )}
                
                {/* ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ */}
                {!submitted && (
                  <div className="flex gap-3">
                    <button
                      onClick={handlePrevSentence}
                      disabled={currentSentenceIndex === 0}
                      className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    >
                      <ArrowLeft className="w-5 h-5" />
                      ì´ì „ ë¬¸ì¥
                    </button>
                    <button
                      onClick={handleNextSentence}
                      disabled={isLastSentence}
                      className="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    >
                      ë‹¤ìŒ ë¬¸ì¥
                      <ArrowRight className="w-5 h-5" />
                    </button>
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      </div>
      
      {/* ê²°ê³¼ ëª¨ë‹¬ */}
      {result && (
        <ResultModal
          isOpen={showResult}
          result={result}
          highlightedWords={getHighlightedWords(currentParagraph.text, result)}
          originalText={currentParagraph.text}
          userAnswer={userAnswer}
          onRetry={handleRetry}
          onNext={handleResultNext}
        />
      )}
    </>
  )
}
```

=== ì¶œë ¥ ìš”êµ¬ì‚¬í•­ ===

1. âœ… 2ë‹¨ê³„ í•™ìŠµ í”Œë¡œìš°
   - 1ë‹¨ê³„: ì „ì²´ ë“£ê¸°
   - 2ë‹¨ê³„: ë¬¸ì¥ë³„ í•™ìŠµ

2. âœ… 1ë‹¨ê³„ ê¸°ëŠ¥
   - ì „ì²´ ì˜¤ë””ì˜¤ ì¬ìƒ
   - ì—¬ëŸ¬ ë²ˆ ë°˜ë³µ ê°€ëŠ¥
   - ì¬ìƒ íšŸìˆ˜ í‘œì‹œ
   - ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ í•œëˆˆì—
   - ì „ì²´ ë²ˆì—­ í† ê¸€
   - ë‹¨ì–´ í´ë¦­ ê¸°ëŠ¥
   - "ë¬¸ì¥ë³„ í•™ìŠµ ì‹œì‘" ë²„íŠ¼

3. âœ… 2ë‹¨ê³„ ê¸°ëŠ¥
   - í˜„ì¬ ë¬¸ì¥ ê°•ì¡°
   - ì§„í–‰ë¥  í‘œì‹œ
   - ë¬¸ì¥ë³„ ì˜¤ë””ì˜¤
   - ì´ì „/ë‹¤ìŒ ë²„íŠ¼
   - ë°›ì•„ì“°ê¸°
   - ì „ì²´ ë“£ê¸°ë¡œ ëŒì•„ê°€ê¸°

4. âœ… UI/UX
   - ë‹¨ê³„ë³„ ì•ˆë‚´ ë©”ì‹œì§€
   - ì‹œê°ì  êµ¬ë¶„ (ìƒ‰ìƒ)
   - ì§ê´€ì ì¸ ë„¤ë¹„ê²Œì´ì…˜
   - ëª¨ë°”ì¼ ë°˜ì‘í˜•

ì™„ì„± í›„:
- í•™ìŠµ í”Œë¡œìš° ê°œì„  ì™„ë£Œ!
- ì‹¤ì œ ë¦¬ìŠ¤ë‹ í•™ìŠµ ë°©ì‹ ë°˜ì˜
- ì‚¬ìš©ì ê²½í—˜ ëŒ€í­ ê°œì„ 

ì§€ê¸ˆ ë°”ë¡œ ìˆ˜ì •í•´ì¤˜!
ì™„ì„±ë˜ë©´ ì•Œë ¤ì¤˜!
```

---

## ğŸ¯ **ê°œì„  í¬ì¸íŠ¸ ìš”ì•½**

### **Before (í˜„ì¬):**
```
ë¬¸ì¥1 | ë¬¸ì¥2 | ë¬¸ì¥3 | ë¬¸ì¥4 ...
â†’ ê°œë³„ì ìœ¼ë¡œë§Œ í‘œì‹œ
â†’ ì „ì²´ íë¦„ íŒŒì•… ì–´ë ¤ì›€
```

### **After (ê°œì„ ):**
```
1ë‹¨ê³„: ì „ì²´ ë“£ê¸°
â”œâ”€ ì „ì²´ ì˜¤ë””ì˜¤ ì­‰ ì¬ìƒ
â”œâ”€ ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ ë³´ê¸°
â”œâ”€ ì—¬ëŸ¬ ë²ˆ ë°˜ë³µ
â””â”€ í° ê·¸ë¦¼ íŒŒì•…

â†“ (ì¤€ë¹„ë˜ë©´)

2ë‹¨ê³„: ë¬¸ì¥ë³„ í•™ìŠµ
â”œâ”€ ë¬¸ì¥1 ì§‘ì¤‘ â†’ ë°›ì•„ì“°ê¸°
â”œâ”€ ë¬¸ì¥2 ì§‘ì¤‘ â†’ ë°›ì•„ì“°ê¸°
â”œâ”€ ë¬¸ì¥3 ì§‘ì¤‘ â†’ ë°›ì•„ì“°ê¸°
â””â”€ ì„¸ë¶€ í•™ìŠµ
```

---

## ğŸ’¡ **ì™œ ì´ê²Œ ë” ì¢‹ì€ê°€?**
```
ì‹¤ì œ ë¦¬ìŠ¤ë‹ ì‹œí—˜/ì‹¤ì „:
1. ì „ì²´ë¥¼ ë¨¼ì € ë“£ê³ 
2. ì§ˆë¬¸ì— ë‹µí•˜ê±°ë‚˜
3. ì„¸ë¶€ ë‚´ìš© íŒŒì•…

í˜„ì¬ ë°©ì‹:
âŒ ë¬¸ì¥ë§Œ ê°œë³„ì ìœ¼ë¡œ
â†’ ë§¥ë½ íŒŒì•… ì–´ë ¤ì›€

ê°œì„ ëœ ë°©ì‹:
âœ… ì „ì²´ â†’ ë¶€ë¶„
â†’ ì‹¤ì „ê³¼ ë™ì¼
â†’ í•™ìŠµ íš¨ê³¼ UP!