Listening ëª¨ë“ˆì— ì ìˆ˜ ê³„ì‚°ê³¼ ì§„ë„ ì €ì¥ ì‹œìŠ¤í…œì„ ì¶”ê°€í•´ì¤˜.

=== Phase 2: ì ìˆ˜ ê³„ì‚° + ì§„ë„ ì €ì¥ ===

ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ì‚¬ìš©ìì˜ ë‹µë³€ì„ ë¶„ì„í•˜ê³ 
ì ìˆ˜ë¥¼ ê³„ì‚°í•œ í›„ ì§„ë„ë¥¼ ì €ì¥í•  ê±°ì•¼.

=== í…ìŠ¤íŠ¸ ë¹„êµ ì•Œê³ ë¦¬ì¦˜ ===

lib/listening/scoreUtils.ts ìƒì„±:
```typescript
// í…ìŠ¤íŠ¸ ì •ê·œí™” (ëŒ€ì†Œë¬¸ì, êµ¬ë‘ì  ì œê±°)
function normalizeText(text: string): string {
  return text
    .toLowerCase()
    .replace(/[.,!?;:'"]/g, '') // êµ¬ë‘ì  ì œê±°
    .replace(/\s+/g, ' ') // ì—¬ëŸ¬ ê³µë°±ì„ í•˜ë‚˜ë¡œ
    .trim()
}

// ë‹¨ì–´ ë°°ì—´ë¡œ ë¶„ë¦¬
function getWords(text: string): string[] {
  return normalizeText(text).split(' ').filter(word => word.length > 0)
}

// ë ˆë²¤ìŠˆíƒ€ì¸ ê±°ë¦¬ (í¸ì§‘ ê±°ë¦¬)
function levenshteinDistance(str1: string, str2: string): number {
  const len1 = str1.length
  const len2 = str2.length
  const matrix: number[][] = []

  for (let i = 0; i <= len1; i++) {
    matrix[i] = [i]
  }

  for (let j = 0; j <= len2; j++) {
    matrix[0][j] = j
  }

  for (let i = 1; i <= len1; i++) {
    for (let j = 1; j <= len2; j++) {
      const cost = str1[i - 1] === str2[j - 1] ? 0 : 1
      matrix[i][j] = Math.min(
        matrix[i - 1][j] + 1, // ì‚­ì œ
        matrix[i][j - 1] + 1, // ì‚½ì…
        matrix[i - 1][j - 1] + cost // êµì²´
      )
    }
  }

  return matrix[len1][len2]
}

// ë‘ ë‹¨ì–´ê°€ ë¹„ìŠ·í•œì§€ ì²´í¬ (ì˜¤íƒ€ í—ˆìš©)
function isSimilar(word1: string, word2: string, threshold: number = 0.8): boolean {
  if (word1 === word2) return true
  
  const maxLen = Math.max(word1.length, word2.length)
  const distance = levenshteinDistance(word1, word2)
  const similarity = 1 - distance / maxLen
  
  return similarity >= threshold
}

// ë©”ì¸ ë¹„êµ í•¨ìˆ˜
export interface ComparisonResult {
  correctWords: string[] // ì •í™•íˆ ë§ì€ ë‹¨ì–´
  incorrectWords: Array<{ // í‹€ë¦° ë‹¨ì–´
    user: string
    correct: string
    position: number
  }>
  missedWords: string[] // ë†“ì¹œ ë‹¨ì–´ (ë§ ì•ˆ í•¨)
  extraWords: string[] // ì¶”ê°€ ë‹¨ì–´ (ì›ë³¸ì— ì—†ìŒ)
  accuracy: number // ì •í™•ë„ (0-100)
  score: number // ìµœì¢… ì ìˆ˜ (0-100)
}

export function compareTexts(
  originalText: string,
  userText: string
): ComparisonResult {
  const originalWords = getWords(originalText)
  const userWords = getWords(userText)
  
  const correctWords: string[] = []
  const incorrectWords: Array<{ user: string; correct: string; position: number }> = []
  const missedWords: string[] = []
  const extraWords: string[] = []
  
  // ë‹¨ì–´ë³„ ë¹„êµ
  const maxLength = Math.max(originalWords.length, userWords.length)
  
  for (let i = 0; i < maxLength; i++) {
    const original = originalWords[i]
    const user = userWords[i]
    
    if (!original && user) {
      // ì¶”ê°€ëœ ë‹¨ì–´
      extraWords.push(user)
    } else if (original && !user) {
      // ë†“ì¹œ ë‹¨ì–´
      missedWords.push(original)
    } else if (original && user) {
      if (original === user) {
        // ì •í™•íˆ ë§ìŒ
        correctWords.push(original)
      } else if (isSimilar(original, user, 0.8)) {
        // ë¹„ìŠ·í•¨ (ì˜¤íƒ€ í—ˆìš©) - ì •ë‹µìœ¼ë¡œ ì²˜ë¦¬
        correctWords.push(original)
      } else {
        // ì™„ì „íˆ ë‹¤ë¦„
        incorrectWords.push({
          user: user,
          correct: original,
          position: i
        })
      }
    }
  }
  
  // ì •í™•ë„ ê³„ì‚°
  const totalWords = originalWords.length
  const correctCount = correctWords.length
  const accuracy = totalWords > 0 ? Math.round((correctCount / totalWords) * 100) : 0
  
  // ì ìˆ˜ ê³„ì‚° (í˜ë„í‹° ì ìš©)
  let score = accuracy
  
  // í‹€ë¦° ë‹¨ì–´ í˜ë„í‹° (-2ì ì”©)
  score -= incorrectWords.length * 2
  
  // ë†“ì¹œ ë‹¨ì–´ í˜ë„í‹° (-3ì ì”©, ë” ì¤‘ìš”)
  score -= missedWords.length * 3
  
  // ì¶”ê°€ ë‹¨ì–´ í˜ë„í‹° (-1ì ì”©)
  score -= extraWords.length * 1
  
  // ìµœì†Œ 0ì , ìµœëŒ€ 100ì 
  score = Math.max(0, Math.min(100, score))
  
  return {
    correctWords,
    incorrectWords,
    missedWords,
    extraWords,
    accuracy,
    score
  }
}

// ë‹¨ì–´ í•˜ì´ë¼ì´íŠ¸ìš© (ì›ë³¸ í…ìŠ¤íŠ¸ì— ìƒ‰ìƒ ì •ë³´ ì¶”ê°€)
export interface HighlightedWord {
  word: string
  status: 'correct' | 'incorrect' | 'missed'
  userWord?: string // í‹€ë ¸ì„ ë•Œ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë‹¨ì–´
}

export function getHighlightedWords(
  originalText: string,
  comparisonResult: ComparisonResult
): HighlightedWord[] {
  const originalWords = getWords(originalText)
  const highlighted: HighlightedWord[] = []
  
  originalWords.forEach((word, index) => {
    if (comparisonResult.correctWords.includes(word)) {
      highlighted.push({ word, status: 'correct' })
    } else if (comparisonResult.missedWords.includes(word)) {
      highlighted.push({ word, status: 'missed' })
    } else {
      const incorrect = comparisonResult.incorrectWords.find(
        item => item.position === index
      )
      if (incorrect) {
        highlighted.push({
          word,
          status: 'incorrect',
          userWord: incorrect.user
        })
      }
    }
  })
  
  return highlighted
}
```

=== ê²°ê³¼ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸ ===

components/listening/ResultModal.tsx ìƒì„±:
```tsx
'use client'

import { Trophy, TrendingUp, AlertCircle, CheckCircle, XCircle } from 'lucide-react'
import type { ComparisonResult, HighlightedWord } from '@/lib/listening/scoreUtils'

interface ResultModalProps {
  isOpen: boolean
  result: ComparisonResult
  highlightedWords: HighlightedWord[]
  originalText: string
  userAnswer: string
  onRetry: () => void
  onNext: () => void
}

export default function ResultModal({
  isOpen,
  result,
  highlightedWords,
  originalText,
  userAnswer,
  onRetry,
  onNext
}: ResultModalProps) {
  if (!isOpen) return null
  
  const getScoreColor = (score: number) => {
    if (score >= 90) return 'text-green-600'
    if (score >= 70) return 'text-blue-600'
    if (score >= 50) return 'text-orange-600'
    return 'text-red-600'
  }
  
  const getScoreMessage = (score: number) => {
    if (score >= 90) return 'ì™„ë²½í•´ìš”! ğŸ‰'
    if (score >= 70) return 'ì˜í–ˆì–´ìš”! ğŸ‘'
    if (score >= 50) return 'ê´œì°®ì•„ìš”! ğŸ’ª'
    return 'ë‹¤ì‹œ í•œë²ˆ ì—°ìŠµí•´ë´ìš”! ğŸ“š'
  }
  
  const getScoreIcon = (score: number) => {
    if (score >= 90) return 'ğŸ†'
    if (score >= 70) return 'â­'
    if (score >= 50) return 'ğŸ’¡'
    return 'ğŸ“–'
  }
  
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50">
      <div className="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        {/* ì ìˆ˜ í—¤ë” */}
        <div className="bg-gradient-to-br from-blue-50 to-purple-50 p-8 text-center">
          <div className="text-6xl mb-4">{getScoreIcon(result.score)}</div>
          <h2 className={`text-5xl font-bold mb-2 ${getScoreColor(result.score)}`}>
            {result.score}ì 
          </h2>
          <p className="text-lg text-gray-600">{getScoreMessage(result.score)}</p>
        </div>
        
        <div className="p-6 space-y-6">
          {/* ì •í™•ë„ */}
          <div>
            <div className="flex items-center justify-between mb-2">
              <span className="text-sm font-medium text-gray-700">ì •í™•ë„</span>
              <span className="text-sm font-semibold">{result.accuracy}%</span>
            </div>
            <div className="w-full bg-gray-200 rounded-full h-3">
              <div
                className={`h-3 rounded-full transition-all ${
                  result.accuracy >= 90
                    ? 'bg-green-600'
                    : result.accuracy >= 70
                    ? 'bg-blue-600'
                    : result.accuracy >= 50
                    ? 'bg-orange-600'
                    : 'bg-red-600'
                }`}
                style={{ width: `${result.accuracy}%` }}
              />
            </div>
          </div>
          
          {/* í†µê³„ */}
          <div className="grid grid-cols-3 gap-4">
            <div className="bg-green-50 rounded-lg p-4 text-center">
              <CheckCircle className="w-6 h-6 text-green-600 mx-auto mb-2" />
              <p className="text-2xl font-bold text-green-600">
                {result.correctWords.length}
              </p>
              <p className="text-xs text-gray-600">ë§ì€ ë‹¨ì–´</p>
            </div>
            
            <div className="bg-orange-50 rounded-lg p-4 text-center">
              <AlertCircle className="w-6 h-6 text-orange-600 mx-auto mb-2" />
              <p className="text-2xl font-bold text-orange-600">
                {result.missedWords.length}
              </p>
              <p className="text-xs text-gray-600">ë†“ì¹œ ë‹¨ì–´</p>
            </div>
            
            <div className="bg-red-50 rounded-lg p-4 text-center">
              <XCircle className="w-6 h-6 text-red-600 mx-auto mb-2" />
              <p className="text-2xl font-bold text-red-600">
                {result.incorrectWords.length}
              </p>
              <p className="text-xs text-gray-600">í‹€ë¦° ë‹¨ì–´</p>
            </div>
          </div>
          
          {/* í•˜ì´ë¼ì´íŠ¸ëœ ì •ë‹µ */}
          <div>
            <h3 className="font-semibold text-gray-900 mb-3">ì •ë‹µ (ë‹¨ì–´ë³„ ë¶„ì„)</h3>
            <div className="bg-gray-50 rounded-lg p-4">
              <div className="flex flex-wrap gap-2">
                {highlightedWords.map((item, index) => (
                  <span
                    key={index}
                    className={`px-3 py-1 rounded-lg font-medium ${
                      item.status === 'correct'
                        ? 'bg-green-100 text-green-800'
                        : item.status === 'missed'
                        ? 'bg-orange-100 text-orange-800'
                        : 'bg-red-100 text-red-800'
                    }`}
                    title={
                      item.status === 'incorrect'
                        ? `ë‹¹ì‹ ì˜ ë‹µë³€: "${item.userWord}"`
                        : undefined
                    }
                  >
                    {item.word}
                    {item.status === 'incorrect' && item.userWord && (
                      <span className="text-xs ml-1">
                        (ì…ë ¥: {item.userWord})
                      </span>
                    )}
                  </span>
                ))}
              </div>
            </div>
          </div>
          
          {/* ë‹¹ì‹ ì˜ ë‹µë³€ */}
          <div>
            <h3 className="font-semibold text-gray-900 mb-3">ë‹¹ì‹ ì˜ ë‹µë³€</h3>
            <div className="bg-blue-50 rounded-lg p-4">
              <p className="text-gray-800">{userAnswer}</p>
            </div>
          </div>
          
          {/* ë†“ì¹œ ë‹¨ì–´ ìƒì„¸ */}
          {result.missedWords.length > 0 && (
            <div className="bg-orange-50 border border-orange-200 rounded-lg p-4">
              <h4 className="font-semibold text-orange-800 mb-2">
                ğŸ’¡ ë†“ì¹œ ë‹¨ì–´ë“¤
              </h4>
              <div className="flex flex-wrap gap-2">
                {result.missedWords.map((word, index) => (
                  <span
                    key={index}
                    className="px-3 py-1 bg-white rounded-lg text-orange-800 font-medium"
                  >
                    {word}
                  </span>
                ))}
              </div>
              <p className="text-sm text-orange-700 mt-3">
                ì´ ë‹¨ì–´ë“¤ì„ ë‹¤ì‹œ ë“¤ì–´ë³´ì„¸ìš”!
              </p>
            </div>
          )}
          
          {/* í‹€ë¦° ë‹¨ì–´ ìƒì„¸ */}
          {result.incorrectWords.length > 0 && (
            <div className="bg-red-50 border border-red-200 rounded-lg p-4">
              <h4 className="font-semibold text-red-800 mb-2">
                âŒ í‹€ë¦° ë‹¨ì–´ë“¤
              </h4>
              <div className="space-y-2">
                {result.incorrectWords.map((item, index) => (
                  <div
                    key={index}
                    className="flex items-center justify-between bg-white rounded-lg p-3"
                  >
                    <div>
                      <span className="text-red-600 font-medium">
                        ì…ë ¥: "{item.user}"
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span className="text-gray-400">â†’</span>
                      <span className="text-green-600 font-medium">
                        ì •ë‹µ: "{item.correct}"
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
          
          {/* ì¶”ê°€ ë‹¨ì–´ */}
          {result.extraWords.length > 0 && (
            <div className="bg-purple-50 border border-purple-200 rounded-lg p-4">
              <h4 className="font-semibold text-purple-800 mb-2">
                â• ì¶”ê°€ëœ ë‹¨ì–´ë“¤
              </h4>
              <p className="text-sm text-purple-700 mb-2">
                ì›ë³¸ì— ì—†ëŠ” ë‹¨ì–´ë¥¼ ì…ë ¥í–ˆì–´ìš”
              </p>
              <div className="flex flex-wrap gap-2">
                {result.extraWords.map((word, index) => (
                  <span
                    key={index}
                    className="px-3 py-1 bg-white rounded-lg text-purple-800 font-medium"
                  >
                    {word}
                  </span>
                ))}
              </div>
            </div>
          )}
          
          {/* ë²„íŠ¼ */}
          <div className="flex gap-3 pt-4">
            <button
              onClick={onRetry}
              className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium"
            >
              ë‹¤ì‹œ ì—°ìŠµí•˜ê¸°
            </button>
            <button
              onClick={onNext}
              className="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium"
            >
              ë‹¤ìŒ ë ˆìŠ¨
            </button>
          </div>
        </div>
      </div>
    </div>
  )
}
```

=== ListeningCard ì—…ë°ì´íŠ¸ ===

components/listening/ListeningCard.tsx ìˆ˜ì •:
```tsx
'use client'

import { useState } from 'react'
import { X, Eye, EyeOff } from 'lucide-react'
import AudioPlayer from './AudioPlayer'
import DictationInput from './DictationInput'
import ResultModal from './ResultModal'
import { compareTexts, getHighlightedWords } from '@/lib/listening/scoreUtils'
import type { ComparisonResult } from '@/lib/listening/scoreUtils'

interface Lesson {
  id: string
  text: string
  translation: string
  difficulty: number
  category: string
}

interface ListeningCardProps {
  lesson: Lesson
  onClose: () => void
  onComplete: () => void
}

export default function ListeningCard({ lesson, onClose, onComplete }: ListeningCardProps) {
  const [showTranslation, setShowTranslation] = useState(false)
  const [submitted, setSubmitted] = useState(false)
  const [userAnswer, setUserAnswer] = useState('')
  const [result, setResult] = useState<ComparisonResult | null>(null)
  const [showResult, setShowResult] = useState(false)
  
  const handleSubmit = async (answer: string) => {
    setUserAnswer(answer)
    setSubmitted(true)
    
    // í…ìŠ¤íŠ¸ ë¹„êµ ë° ì ìˆ˜ ê³„ì‚°
    const comparisonResult = compareTexts(lesson.text, answer)
    setResult(comparisonResult)
    
    // ì§„ë„ ì €ì¥ ë° XP ì ë¦½
    try {
      const response = await fetch('/api/listening/progress', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          lessonId: lesson.id,
          userAnswer: answer,
          score: comparisonResult.score,
          accuracy: comparisonResult.accuracy,
          completed: comparisonResult.score >= 70 // 70ì  ì´ìƒì´ë©´ ì™„ë£Œ
        })
      })
      
      if (!response.ok) {
        throw new Error('Failed to save progress')
      }
      
      // XP ì ë¦½ (ì ìˆ˜ì— ë”°ë¼)
      const xpAmount = Math.floor(comparisonResult.score / 5) // 100ì  = 20 XP
      await fetch('/api/gamification/xp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          amount: xpAmount,
          source: 'listening'
        })
      })
      
      // ê²°ê³¼ ëª¨ë‹¬ í‘œì‹œ
      setShowResult(true)
      
    } catch (error) {
      console.error('Failed to save progress:', error)
    }
  }
  
  const handleRetry = () => {
    setSubmitted(false)
    setUserAnswer('')
    setResult(null)
    setShowResult(false)
  }
  
  const handleNext = () => {
    setShowResult(false)
    onComplete()
  }
  
  return (
    <>
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50">
        <div className="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
          {/* í—¤ë” */}
          <div className="sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between">
            <div>
              <h2 className="text-xl font-bold text-gray-900">Listening ì—°ìŠµ</h2>
              <div className="flex items-center gap-3 mt-1">
                <span className="text-sm text-gray-600">
                  Level {lesson.difficulty}
                </span>
                <span className="text-sm text-gray-400">â€¢</span>
                <span className="text-sm text-gray-600">
                  {lesson.category}
                </span>
              </div>
            </div>
            
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <X className="w-6 h-6" />
            </button>
          </div>
          
          {/* ì½˜í…ì¸  */}
          <div className="p-6 space-y-6">
            {/* ë²ˆì—­ í† ê¸€ */}
            <div className="flex justify-end">
              <button
                onClick={() => setShowTranslation(!showTranslation)}
                className="flex items-center gap-2 px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
              >
                {showTranslation ? (
                  <>
                    <EyeOff className="w-4 h-4" />
                    ë²ˆì—­ ìˆ¨ê¸°ê¸°
                  </>
                ) : (
                  <>
                    <Eye className="w-4 h-4" />
                    ë²ˆì—­ ë³´ê¸°
                  </>
                )}
              </button>
            </div>
            
            {/* ë²ˆì—­ */}
            {showTranslation && (
              <div className="bg-blue-50 border border-blue-200 rounded-xl p-4">
                <p className="text-gray-700 text-center">
                  {lesson.translation}
                </p>
              </div>
            )}
            
            {/* ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ */}
            <AudioPlayer text={lesson.text} />
            
            {/* ë°›ì•„ì“°ê¸° ì…ë ¥ */}
            {!submitted && (
              <DictationInput onSubmit={handleSubmit} />
            )}
          </div>
        </div>
      </div>
      
      {/* ê²°ê³¼ ëª¨ë‹¬ */}
      {result && (
        <ResultModal
          isOpen={showResult}
          result={result}
          highlightedWords={getHighlightedWords(lesson.text, result)}
          originalText={lesson.text}
          userAnswer={userAnswer}
          onRetry={handleRetry}
          onNext={handleNext}
        />
      )}
    </>
  )
}
```

=== ì§„ë„ ì €ì¥ API ===

app/api/listening/progress/route.ts ìƒì„±:
```tsx
import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs'
import { cookies } from 'next/headers'
import { NextResponse } from 'next/server'

export async function POST(req: Request) {
  try {
    const supabase = createRouteHandlerClient({ cookies })
    
    const {
      data: { session },
    } = await supabase.auth.getSession()

    if (!session) {
      return NextResponse.json(
        { error: 'Unauthorized' },
        { status: 401 }
      )
    }

    const { lessonId, userAnswer, score, accuracy, completed } = await req.json()

    // ì§„ë„ ì €ì¥
    const { data, error } = await supabase
      .from('listening_progress')
      .insert({
        user_id: session.user.id,
        lesson_id: lessonId,
        user_answer: userAnswer,
        score: score,
        accuracy: accuracy,
        completed: completed
      })
      .select()
      .single()

    if (error) throw error

    // user_stats ì—…ë°ì´íŠ¸ (ì˜¤ëŠ˜ ë‚ ì§œ)
    const today = new Date().toISOString().split('T')[0]
    
    const { error: statsError } = await supabase.rpc('update_user_stats', {
      p_user_id: session.user.id,
      p_date: today,
      p_lessons_completed: completed ? 1 : 0,
      p_time_spent: 60 // 1ë¶„ (ì¶”ì •)
    })

    if (statsError) {
      console.error('Stats update error:', statsError)
      // ì—ëŸ¬ê°€ ë‚˜ë„ ì§„í–‰ì€ ê³„ì†
    }

    return NextResponse.json({
      success: true,
      data: data
    })

  } catch (error) {
    console.error('Progress save error:', error)
    return NextResponse.json(
      { error: 'Failed to save progress' },
      { status: 500 }
    )
  }
}

// ì§„ë„ ì¡°íšŒ (í†µê³„ìš©)
export async function GET(req: Request) {
  try {
    const supabase = createRouteHandlerClient({ cookies })
    
    const {
      data: { session },
    } = await supabase.auth.getSession()

    if (!session) {
      return NextResponse.json(
        { error: 'Unauthorized' },
        { status: 401 }
      )
    }

    const { data, error } = await supabase
      .from('listening_progress')
      .select('*')
      .eq('user_id', session.user.id)
      .order('completed_at', { ascending: false })
      .limit(50)

    if (error) throw error

    return NextResponse.json({ progress: data })
  } catch (error) {
    console.error('Progress fetch error:', error)
    return NextResponse.json(
      { error: 'Failed to fetch progress' },
      { status: 500 }
    )
  }
}
```

=== Supabase RPC í•¨ìˆ˜ (í†µê³„ ì—…ë°ì´íŠ¸ìš©) ===

Supabase SQL Editorì—ì„œ ì‹¤í–‰:
```sql
-- user_stats ì—…ë°ì´íŠ¸ í•¨ìˆ˜
CREATE OR REPLACE FUNCTION update_user_stats(
  p_user_id UUID,
  p_date DATE,
  p_lessons_completed INTEGER DEFAULT 0,
  p_time_spent INTEGER DEFAULT 0
)
RETURNS void
LANGUAGE plpgsql
AS $$
BEGIN
  INSERT INTO user_stats (user_id, date, lessons_completed, time_spent)
  VALUES (p_user_id, p_date, p_lessons_completed, p_time_spent)
  ON CONFLICT (user_id, date)
  DO UPDATE SET
    lessons_completed = user_stats.lessons_completed + p_lessons_completed,
    time_spent = user_stats.time_spent + p_time_spent;
END;
$$;
```

=== XP í† ìŠ¤íŠ¸ ì•Œë¦¼ ===

ListeningCard.tsxì— í† ìŠ¤íŠ¸ ì¶”ê°€:
```tsx
import { toast } from 'sonner' // ë˜ëŠ” ê¸°ì¡´ í† ìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬

// XP ì ë¦½ í›„
if (xpAmount > 0) {
  toast.success(`+${xpAmount} XP íšë“!`, {
    icon: 'â­',
    duration: 3000
  })
}
```

=== ì¶œë ¥ ìš”êµ¬ì‚¬í•­ ===

1. âœ… í…ìŠ¤íŠ¸ ë¹„êµ ì•Œê³ ë¦¬ì¦˜ ì‘ë™
2. âœ… ë ˆë²¤ìŠˆíƒ€ì¸ ê±°ë¦¬ë¡œ ì˜¤íƒ€ í—ˆìš©
3. âœ… ì ìˆ˜ ê³„ì‚° (0-100)
4. âœ… ì •í™•ë„ ê³„ì‚° (0-100%)
5. âœ… ë‹¨ì–´ë³„ ìƒíƒœ êµ¬ë¶„ (ë§ìŒ/í‹€ë¦¼/ë†“ì¹¨)
6. âœ… ê²°ê³¼ ëª¨ë‹¬ í‘œì‹œ
7. âœ… í•˜ì´ë¼ì´íŠ¸ëœ ì •ë‹µ í‘œì‹œ
8. âœ… í‹€ë¦°/ë†“ì¹œ ë‹¨ì–´ ìƒì„¸ ë¶„ì„
9. âœ… ì§„ë„ DB ì €ì¥
10. âœ… XP ìë™ ì ë¦½ (ì ìˆ˜ ë¹„ë¡€)
11. âœ… user_stats ì—…ë°ì´íŠ¸
12. âœ… í† ìŠ¤íŠ¸ ì•Œë¦¼
13. âœ… ë‹¤ì‹œ í•˜ê¸° / ë‹¤ìŒ ë ˆìŠ¨ ì‘ë™

ì™„ì„± í›„:
- Listening í•µì‹¬ ê¸°ëŠ¥ ì™„ì„±!
- Speakingê³¼ ë™ì¼í•œ ì ìˆ˜ ì‹œìŠ¤í…œ
- ì‹¤ì œ í•™ìŠµ íš¨ê³¼ ì¸¡ì • ê°€ëŠ¥
- Phase 3 (í†µê³„/ê¸°ë¡) ì¤€ë¹„ ì™„ë£Œ

í…ŒìŠ¤íŠ¸:
1. ë¬¸ì¥ ë“£ê³  ë°›ì•„ì“°ê¸°
2. ì œì¶œ ì‹œ ì ìˆ˜ ê³„ì‚°
3. ê²°ê³¼ ëª¨ë‹¬ì— ìƒì„¸ ë¶„ì„ í‘œì‹œ
4. ë‹¨ì–´ë³„ ìƒ‰ìƒ í™•ì¸ (ì´ˆë¡/ë¹¨ê°•/ì£¼í™©)
5. XP ì¦ê°€ í™•ì¸
6. ì¼ì¼ ëª©í‘œ ì—…ë°ì´íŠ¸ í™•ì¸

ì§€ê¸ˆ ë°”ë¡œ ë§Œë“¤ì–´ì¤˜!
ì™„ì„±ë˜ë©´ ì•Œë ¤ì¤˜!
```

---

## â° **ì˜ˆìƒ ì†Œìš” ì‹œê°„**

- Replit Agent êµ¬í˜„: 2-3ì‹œê°„

---

## â˜• **êµ¬í˜„í•˜ëŠ” ë™ì•ˆ**

**í¸í•˜ê²Œ ì‰¬ì„¸ìš”!**
- ì•¼ì‹
- ê²Œì„
- ìœ íŠœë¸Œ
- íœ´ì‹

**ë˜ëŠ”:**
- ë‚´ì¼ ê³„íš ìƒê°í•˜ê¸°
- Phase 3 (í†µê³„/ê¸°ë¡) ë¯¸ë¦¬ êµ¬ìƒ

---

## âœ… **ì™„ì„± í™•ì¸í•˜ê¸°**

**í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
```
1. ì ìˆ˜ ê³„ì‚°
   âœ… ë°›ì•„ì“°ê¸° ì œì¶œ ì‹œ ì ìˆ˜ ë‚˜ì˜¤ë‚˜?
   âœ… 0-100ì  ì‚¬ì´ì¸ê°€?
   
2. ê²°ê³¼ ëª¨ë‹¬
   âœ… ê²°ê³¼ ëª¨ë‹¬ í‘œì‹œë˜ë‚˜?
   âœ… ì ìˆ˜ í¬ê²Œ ë³´ì´ë‚˜?
   âœ… ë‹¨ì–´ë³„ ìƒ‰ìƒ êµ¬ë¶„ë˜ë‚˜?
   
3. ìƒì„¸ ë¶„ì„
   âœ… ë§ì€ ë‹¨ì–´ (ì´ˆë¡ìƒ‰)
   âœ… í‹€ë¦° ë‹¨ì–´ (ë¹¨ê°„ìƒ‰)
   âœ… ë†“ì¹œ ë‹¨ì–´ (ì£¼í™©ìƒ‰)
   
4. ì§„ë„ ì €ì¥
   âœ… DBì— ì €ì¥ë˜ë‚˜?
   âœ… XP ì¦ê°€í•˜ë‚˜?
   âœ… ì¼ì¼ ëª©í‘œ ì—…ë°ì´íŠ¸?
   
5. ë²„íŠ¼
   âœ… ë‹¤ì‹œ í•˜ê¸° ì‘ë™?
   âœ… ë‹¤ìŒ ë ˆìŠ¨ ì‘ë™?
```

---

## ğŸ‰ **ì™„ì„±ë˜ë©´**

**Phase 2 ì™„ë£Œ!**
```
âœ… ì ìˆ˜ ê³„ì‚° ì™„ì„±
âœ… ì§„ë„ ì €ì¥ ì™„ì„±
âœ… XP ì ë¦½ ì™„ì„±
âœ… ê²°ê³¼ ëª¨ë‹¬ ì™„ì„±

ë‹¤ìŒ (Phase 3):
- í•™ìŠµ ê¸°ë¡ í˜ì´ì§€
- í†µê³„ í˜ì´ì§€
- ì˜¨ë³´ë”©

â†’ ë‚´ì¼ ì™„ì„±í•˜ë©´ Listening 100%!