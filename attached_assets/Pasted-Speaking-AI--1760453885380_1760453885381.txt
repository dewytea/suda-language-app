Speaking ëª¨ë“ˆì— AI í”¼ë“œë°± ê¸°ëŠ¥ì„ ì¶”ê°€í•´ì¤˜.

=== í˜„ì¬ ìƒíƒœ ===
- ìŒì„± ì¸ì‹ ì‘ë™ âœ…
- ì ìˆ˜ ê³„ì‚° ì‘ë™ âœ…
- ë‹¨ì–´ë³„ ë¹„êµ ì‘ë™ âœ…

=== ì¶”ê°€í•  ê¸°ëŠ¥ ===
ì‚¬ìš©ì ë°œìŒì— ëŒ€í•œ AI í”¼ë“œë°± ìƒì„±

=== 1. OpenAI API ì„¤ì • ===

1.1 í™˜ê²½ ë³€ìˆ˜ (.env.local)
OPENAI_API_KEY=your_api_key

1.2 API ì—”ë“œí¬ì¸íŠ¸ ìƒì„±
app/api/speaking/feedback/route.ts

=== 2. AI í”¼ë“œë°± ë¡œì§ ===

2.1 route.ts
import OpenAI from 'openai';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export async function POST(req: Request) {
  const { 
    originalText, 
    spokenText, 
    score, 
    missedWords,
    extraWords 
  } = await req.json();
  
  const prompt = `
ë‹¹ì‹ ì€ ì¹œê·¼í•œ ì–¸ì–´ í•™ìŠµ ì½”ì¹˜ì…ë‹ˆë‹¤.

í•™ìŠµìê°€ ë‹¤ìŒ ë¬¸ì¥ì„ ì—°ìŠµí–ˆìŠµë‹ˆë‹¤:
ì›ë³¸: "${originalText}"
í•™ìŠµìê°€ ë§í•œ ê²ƒ: "${spokenText}"
ì ìˆ˜: ${score}/100

ë†“ì¹œ ë‹¨ì–´: ${missedWords.join(', ') || 'ì—†ìŒ'}
ì¶”ê°€ëœ ë‹¨ì–´: ${extraWords.join(', ') || 'ì—†ìŒ'}

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì§§ê³  ê²©ë ¤ì ì¸ í”¼ë“œë°±ì„ ì‘ì„±í•´ì£¼ì„¸ìš”:

1. ì¹­ì°¬ (í•œ ì¤„)
2. ê°œì„ ì  (í•œ ì¤„, ìˆìœ¼ë©´)
3. íŒ (í•œ ì¤„)

ì˜ˆì‹œ:
ë°œìŒì´ ëª…í™•í–ˆì–´ìš”! ğŸ‘
"business"ì˜ ë°œìŒì— ì¡°ê¸ˆ ë” ì‹ ê²½ ì“°ë©´ ì™„ë²½í•  ê±°ì˜ˆìš”.
ğŸ’¡ íŒ: ë…¹ìŒì„ ë“¤ì–´ë³´ë©´ì„œ ì›ì–´ë¯¼ ë°œìŒê³¼ ë¹„êµí•´ë³´ì„¸ìš”!
`;

  try {
    const completion = await openai.chat.completions.create({
      model: "gpt-4o-mini", // ì €ë ´í•œ ëª¨ë¸
      messages: [
        {
          role: "system",
          content: "You are a friendly and encouraging language learning coach."
        },
        {
          role: "user",
          content: prompt
        }
      ],
      temperature: 0.7,
      max_tokens: 200,
    });
    
    const feedback = completion.choices[0].message.content;
    
    return Response.json({ feedback });
    
  } catch (error) {
    console.error('OpenAI API error:', error);
    return Response.json(
      { error: 'Failed to generate feedback' },
      { status: 500 }
    );
  }
}

=== 3. í”„ë¡ íŠ¸ì—”ë“œ í†µí•© ===

3.1 ë¶„ì„ í•¨ìˆ˜ ì—…ë°ì´íŠ¸
const analyzeRecording = async (spokenText: string) => {
  // ... ê¸°ì¡´ ë¶„ì„ ì½”ë“œ ...
  
  setAnalysisResult({
    score,
    transcript: spokenText,
    accuracy: comparison.accuracy,
    matchedWords: comparison.matchedWords,
    missedWords: comparison.missedWords,
    extraWords: comparison.extraWords,
    feedback: null, // ì•„ì§ ì—†ìŒ
    isLoadingFeedback: true // ë¡œë”© ì¤‘
  });
  
  // AI í”¼ë“œë°± ìš”ì²­ (ë¹„ë™ê¸°)
  try {
    const response = await fetch('/api/speaking/feedback', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        originalText: currentSentence.text,
        spokenText: spokenText,
        score: score,
        missedWords: comparison.missedWords,
        extraWords: comparison.extraWords
      })
    });
    
    const { feedback } = await response.json();
    
    setAnalysisResult(prev => ({
      ...prev,
      feedback: feedback,
      isLoadingFeedback: false
    }));
    
  } catch (error) {
    console.error('Failed to get AI feedback:', error);
    setAnalysisResult(prev => ({
      ...prev,
      isLoadingFeedback: false
    }));
  }
};

=== 4. UI ì—…ë°ì´íŠ¸ ===

4.1 ê²°ê³¼ ì¹´ë“œì— í”¼ë“œë°± ì„¹ì…˜ ì¶”ê°€
{analysisResult && (
  <div className="mt-6 p-6 bg-white rounded-xl shadow-lg">
    {/* ... ê¸°ì¡´ ì ìˆ˜/ì •í™•ë„ UI ... */}
    
    {/* AI í”¼ë“œë°± ì„¹ì…˜ */}
    <div className="mt-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg">
      <h4 className="font-semibold mb-2 flex items-center">
        <span className="mr-2">ğŸ¤–</span>
        AI ì½”ì¹˜ì˜ í”¼ë“œë°±
      </h4>
      
      {analysisResult.isLoadingFeedback ? (
        <div className="flex items-center text-gray-500">
          <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2" />
          í”¼ë“œë°± ìƒì„± ì¤‘...
        </div>
      ) : analysisResult.feedback ? (
        <div className="text-gray-700 whitespace-pre-line">
          {analysisResult.feedback}
        </div>
      ) : (
        <div className="text-gray-500">
          í”¼ë“œë°±ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
        </div>
      )}
    </div>
    
    {/* ... ê¸°ì¡´ ì•¡ì…˜ ë²„íŠ¼ ... */}
  </div>
)}

=== 5. ë¹„ìš© ì ˆê° ì „ëµ ===

5.1 ì¡°ê±´ë¶€ í”¼ë“œë°±
- ì ìˆ˜ 80ì  ì´ìƒ: AI í”¼ë“œë°± ìƒëµ (ì™„ë²½í•˜ë‹ˆê¹Œ)
- ì ìˆ˜ 50-79ì : AI í”¼ë“œë°± ì œê³µ (ê°œì„  í•„ìš”)
- ì ìˆ˜ 50ì  ë¯¸ë§Œ: AI í”¼ë“œë°± ì œê³µ (ë§ì€ ë„ì›€ í•„ìš”)

5.2 ìºì‹±
- ê°™ì€ ë¬¸ì¥ + ë¹„ìŠ·í•œ ì‹¤ìˆ˜ = ìºì‹œëœ í”¼ë“œë°± ì¬ì‚¬ìš©
- ë°ì´í„°ë² ì´ìŠ¤ì— common_feedback í…Œì´ë¸” ìƒì„±

5.3 ë¡œì»¬ í”¼ë“œë°± ìš°ì„ 
- ê°„ë‹¨í•œ ì‹¤ìˆ˜: ë¡œì»¬ í”¼ë“œë°± (ë¬´ë£Œ)
- ë³µì¡í•œ ê²½ìš°: AI í”¼ë“œë°± (ìœ ë£Œ)

ì˜ˆì‹œ:
if (missedWords.length === 0 && score >= 90) {
  feedback = "ì™„ë²½í•´ìš”! ë°œìŒì´ ì•„ì£¼ ì •í™•í•©ë‹ˆë‹¤! ğŸ‰";
} else if (missedWords.length <= 2) {
  feedback = `ì˜í–ˆì–´ìš”! "${missedWords.join(', ')}" ë¶€ë¶„ë§Œ ë‹¤ì‹œ ì—°ìŠµí•´ë³´ì„¸ìš”!`;
} else {
  // AI í”¼ë“œë°± ìš”ì²­
  feedback = await getAIFeedback(...);
}

=== ì¶œë ¥ ìš”êµ¬ì‚¬í•­ ===
1. AI í”¼ë“œë°±ì´ ë¶„ì„ ê²°ê³¼ì— í‘œì‹œë¨
2. ë¡œë”© ìƒíƒœ í‘œì‹œ
3. ì—ëŸ¬ ì‹œ graceful degradation
4. í”¼ë“œë°±ì´ ê²©ë ¤ì ì´ê³  êµ¬ì²´ì ì„
5. ë¹„ìš© ì ˆê° ë¡œì§ ì‘ë™

ì§€ê¸ˆ ë°”ë¡œ ì¶”ê°€í•´ì¤˜!